let ajaxGetUrlTemplate = ajaxurl;
let ajaxPostUrlTemplate = ajaxurl;
try {
    ajaxGetUrlTemplate = kommo_admin_data.hasOwnProperty('ajax_url_get') ? kommo_admin_data.ajax_url_get : ajaxurl;
    ajaxPostUrlTemplate = kommo_admin_data.hasOwnProperty('ajax_url_post') ? kommo_admin_data.ajax_url_post : ajaxurl;
} catch (e) {

}
let targetId = '';
let targetInstanceId = '';
try {
    targetId = targetIdParsed;
    targetInstanceId = targetInstanceIdParsed;
} catch (e) {
}

function waitForElementToActive(selector) {
    window.KOMMO_FLASH.modals.preloader.hide();

    let interval = setInterval(function () {
        if (jQuery('.overlay-block  .active').length === 0) {
            clearInterval(interval);
            window.KOMMO_FLASH.modals.metods.show_frame();
            jQuery(selector).addClass("active");
        }
    }, 100);
}

jQuery('.add-button-frame-create-new').click(function (e) {
    jQuery('.add-button-frame-create-new').css('display', 'none');
    jQuery('.add-button-frame-create-new-load').css('display', 'flex');

    const data = {
        'action': 'kommo_dashboard_action',
        'chat_button_create': true,
        'nonce': kommo_admin_data.nonce,
        'target_id': targetId,
        'target_instance_id': targetInstanceId,
    };
    jQuery.ajax({
        url: ajaxPostUrlTemplate + '',
        method: 'post',
        dataType: 'json',
        data: data,
        success: function (response) {
            try {
                jQuery(".overlay-block.active, .overlay-block .active").removeClass("active");
                if (response.status !== 200) {
                    window.KOMMO_FLASH.modals.log.show(response)
                } else {
                    window.KOMMO_FLASH.modals.welcome_frame.show()
                    window.KOMMO_FLASH.inbox.button.check_db();
                    window.KOMMO_FLASH.link.button_settings.update(response);
                }
                window.KOMMO_FLASH.inbox.get();
            } catch (e) {
            }
        },
    });
});
jQuery('.add-button-frame-next').click(function (e) {
    jQuery('.add-button-frame .add-button-frame-next').css('display', 'none');
    jQuery('.add-button-frame .add-button-frame-next-load').css('display', 'flex');

    const data = {
        'action': 'kommo_dashboard_action',
        'chat_button_select': true,
        'source_id': window.KOMMO_FLASH.dropdowns.chat_buttons.value,
        'nonce': kommo_admin_data.nonce,
        'target_id': targetId,
        'target_instance_id': targetInstanceId,
    };
    jQuery.ajax({
        url: ajaxPostUrlTemplate + '',
        method: 'post',
        dataType: 'json',
        data: data,
        success: function (response) {
            try {
                jQuery(".overlay-block.active, .overlay-block .active").removeClass("active");
                if (response.status !== 200) {
                    window.KOMMO_FLASH.modals.log.show(response);
                } else {
                    window.KOMMO_FLASH.dropdowns.chat_buttons.value = 0;
                    window.KOMMO_FLASH.modals.welcome_frame.show();
                    window.KOMMO_FLASH.inbox.button.check_db();
                    window.KOMMO_FLASH.link.button_settings.update(response);
                }
            } catch (e) {
            }
        },
    });

    window.KOMMO_FLASH.inbox.get();
});
jQuery('.error-delete-button-user-log-out').click(function (e) {
    jQuery('.error-delete-button-user-log-out').css('display', 'none');
    jQuery('.error-delete-button-user-log-out-load').css('display', 'inline-flex');
    kommoLogout();
});
jQuery('.error-delete-frame-log-out').click(function (e) {
    jQuery('.error-delete-frame-log-out').css('display', 'none');
    jQuery('.error-delete-frame-log-out-load').css('display', 'inline-flex');
    kommoLogout();
});
jQuery('.exit-frame-log-out').click(function (e) {
    jQuery('.exit-frame-log-out').css('display', 'none');
    jQuery('.exit-frame-log-out-load').css('display', 'inline-flex');
    kommoLogout();
});

function kommoLogout() {
    const data = {
        'action': 'kommo_dashboard_action',
        'logout': true,
        'nonce': kommo_admin_data.nonce,
        'target_id': targetId,
        'target_instance_id': targetInstanceId,
    };
    jQuery.ajax({
        url: ajaxPostUrlTemplate + '',
        method: 'post',
        dataType: 'json',
        data: data,
        success: function (response) {
            try {
                if (response.status === 200) {
                    window.location.reload();
                }
            } catch (e) {
            }
        },
    });
}

jQuery('.log-out').click(function (e) {
    e.preventDefault();

    window.KOMMO_FLASH.modals.exit_frame.show();
})

jQuery('.footer-block input[type="checkbox"]').on('click', function () {
    if (jQuery('.footer-block input[type="checkbox"]').prop('checked')) {
        jQuery('#checkbox-text-off').css('display', 'block');
        jQuery('#checkbox-text-on').css('display', 'none');
        window.KOMMO_FLASH.inbox.button.update_db(parseInt(kommoflash_home_page_data.constants.chat_button_switch_true));
    } else {
        window.KOMMO_FLASH.modals.off_button_frame.show()
    }
});
jQuery('.off-button-frame-turn-off').on('click', function () {
    jQuery(".content-home-page").css('position', 'unset');
    jQuery(".overlay-block.active, .overlay-block .active").removeClass("active");
    jQuery('#checkbox-text-off').css('display', 'none');
    jQuery('#checkbox-text-on').css('display', 'block');
    window.KOMMO_FLASH.inbox.button.update_db(parseInt(kommoflash_home_page_data.constants.chat_button_switch_false));
});

window.KOMMO_FLASH = {
    preloader: {
        hide: {
            allow: true,
        }
    },
    request: {
        ajax: {
            list: ['get_buttons_data', 'trial_get_value', 'inbox_get_count', 'button_get_db'],
            count: {
                complete: 0
            }
        },
    },
    modals: {
        preloader: {
            show: function () {
                jQuery("body").css('overflow-y', 'hidden');
                jQuery("html, body").scrollTop(0);
                jQuery(".active").removeClass("active");
                jQuery(".overlay-block").addClass("active");
                jQuery(".preloader-redirect").addClass("active");
            },
            hide: function () {
                jQuery(".overlay-block").removeClass("active");
                jQuery(".preloader-redirect").removeClass("active");
                jQuery("body").css('overflow-y', 'unset');
                jQuery(".trial-frame").addClass(parseInt(kommoflash_home_page_data.account.is_trial_expired) ? '' : 'active');
            }
        },
        metods: {
            show_frame: function () {
                jQuery(".overlay-block.active, .overlay-block .active").removeClass("active");
                jQuery(".overlay-block").addClass("active");
                jQuery("html, body").scrollTop(0);
                jQuery(".content-home-page").css('position', 'fixed');
            }
        },
        error: {
            show: function () {
                window.KOMMO_FLASH.modals.metods.show_frame();
            }
        },
        error_need_button: {
            show: function () {
                waitForElementToActive(".error-delete-frame");
            }
        },
        error_delete_button_user: {
            show: function () {
                waitForElementToActive(".error-delete-button-user");
            }
        },
        log: {
            show: function (response) {
                jQuery(".content-home-page").after(`
                    <div class="error-window">
                        <div class="img">
                            <svg xmlns="http://www.w3.org/2000/svg" width="128" height="136" viewBox="0 0 128 136" fill="none">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M9.42969 43.3791C16.9513 37.7615 26.5306 34.3965 36.9622 34.3965C47.8755 34.3965 57.8559 38.0792 65.5228 44.1716C61.0944 29.3686 50.1516 18.8945 37.3539 18.8945C24.7859 18.8945 14.0067 28.9962 9.42969 43.3791Z" fill="white"/>
                                <path d="M59.3503 44.3935C57.984 48.9473 57.2344 53.9016 57.2344 59.0855C57.2344 81.3887 71.1167 99.4694 88.2404 99.4694C105.364 99.4694 119.246 81.3887 119.246 59.0855C119.246 53.9482 118.509 49.035 117.166 44.5148C109.445 38.2201 99.2981 34.4004 88.1836 34.4004C77.1407 34.4004 67.0529 38.1714 59.3503 44.3935Z" fill="white"/>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M60.8516 43.2512C68.3469 37.7105 77.8597 34.3965 88.212 34.3965C99.1259 34.3965 109.107 38.0796 116.774 44.1726C112.348 29.3671 101.433 18.8945 88.6699 18.8945C76.1733 18.8945 65.4488 28.9345 60.8516 43.2512Z" fill="white"/>
                                <path d="M57.1712 43.8172C55.9548 47.8913 55.2608 52.1192 55.0439 56.3481C54.8462 60.1884 55.0905 64.0232 55.689 67.8234C56.2092 71.1267 57.0553 74.3856 58.2467 77.5264C59.4097 80.5915 60.8612 83.5721 62.6693 86.3394C64.3537 88.9162 66.3389 91.3512 68.6173 93.4754C70.7502 95.4643 73.1728 97.2301 75.8077 98.5737C78.3484 99.8686 81.1094 100.833 83.9579 101.273C87.0494 101.75 90.1239 101.724 93.2041 101.161C96.0366 100.644 98.7874 99.6153 101.292 98.2587C103.902 96.8458 106.299 95.0279 108.397 92.986C110.64 90.8033 112.595 88.3251 114.238 85.7039C116.002 82.8911 117.418 79.8704 118.532 76.7729C119.705 73.5151 120.491 70.1512 120.972 66.7408C121.507 62.9492 121.666 59.1241 121.393 55.3055C121.236 53.0914 120.944 50.8806 120.525 48.6979C120.337 47.7181 120.12 46.7437 119.874 45.7769C119.75 45.2907 119.618 44.8068 119.48 44.3239C119.329 43.7999 119.136 43.2921 118.701 42.9153C118.529 42.767 118.346 42.6295 118.167 42.4898C115.182 40.1458 111.934 38.1277 108.43 36.56C104.844 34.9544 101.073 33.7461 97.1769 33.0489C93.1087 32.3213 88.9472 32.0604 84.8165 32.3505C80.7869 32.6342 76.7833 33.3693 72.9593 34.6188C69.2624 35.827 65.7006 37.4564 62.4354 39.507C60.8056 40.5313 59.2428 41.6594 57.7515 42.8601C57.329 43.2001 57.086 43.8822 57.086 44.391C57.086 44.9226 57.3336 45.556 57.7515 45.9219C58.1842 46.3009 58.7533 46.5824 59.3575 46.5564C59.9878 46.5293 60.4819 46.3106 60.9634 45.9219C61.4563 45.5246 61.9572 45.1381 62.4672 44.7613C62.3138 44.8739 62.1605 44.9865 62.0072 45.1002C65.0192 42.8829 68.322 41.0445 71.8246 39.6283C71.644 39.7009 71.4623 39.7734 71.2818 39.847C74.9253 38.3832 78.7607 37.3872 82.6779 36.8772C82.4769 36.9032 82.2758 36.9292 82.0737 36.9541C86.1215 36.4377 90.2318 36.4366 94.2808 36.9509C94.0797 36.9249 93.8787 36.8989 93.6765 36.874C97.579 37.3796 101.4 38.3681 105.031 39.82C104.85 39.7474 104.668 39.6749 104.488 39.6012C108.012 41.0196 111.335 42.8655 114.364 45.0948C114.211 44.9822 114.058 44.8696 113.904 44.7559C114.469 45.1727 115.022 45.6025 115.565 46.0443C115.371 45.726 115.175 45.4077 114.981 45.0883C115.683 47.4604 116.203 49.878 116.551 52.3206C116.523 52.1289 116.496 51.9373 116.47 51.7446C117.013 55.6314 117.124 59.5713 116.799 63.4798C116.716 64.4737 116.605 65.4643 116.465 66.4528C116.493 66.2612 116.52 66.0695 116.546 65.8768C116.054 69.3284 115.217 72.7356 114.002 76.0204C113.673 76.9115 113.314 77.7928 112.929 78.6643C113.005 78.4922 113.081 78.319 113.158 78.1468C111.713 81.397 109.881 84.4924 107.621 87.2911C107.739 87.145 107.858 86.9988 107.977 86.8526C106.197 89.0461 104.16 91.0491 101.855 92.7467C102.008 92.6341 102.162 92.5215 102.315 92.4079C100.456 93.771 98.4342 94.9251 96.274 95.7988C96.4546 95.7263 96.6363 95.6537 96.8169 95.5801C94.8725 96.3596 92.8338 96.9042 90.744 97.1782C90.945 97.1522 91.1461 97.1262 91.3482 97.1013C89.2902 97.3644 87.2039 97.3644 85.1447 97.1013C85.3458 97.1273 85.5468 97.1533 85.749 97.1782C83.6592 96.9042 81.6194 96.3607 79.6761 95.5801C79.8567 95.6527 80.0384 95.7252 80.219 95.7988C78.0588 94.9251 76.0372 93.7699 74.1779 92.4079C74.3313 92.5205 74.4846 92.633 74.6379 92.7467C72.3346 91.0491 70.2959 89.0472 68.5162 86.8526C68.6343 86.9988 68.7524 87.145 68.8717 87.2911C66.6115 84.4913 64.7795 81.397 63.3349 78.1468C63.411 78.319 63.4871 78.4922 63.5643 78.6643C62.173 75.5159 61.144 72.2267 60.4626 68.8726C60.2604 67.8787 60.09 66.8804 59.9469 65.8768C59.9742 66.0684 60.0014 66.2601 60.0276 66.4528C59.5085 62.7608 59.3813 59.0191 59.6471 55.3023C59.7323 54.1113 59.8595 52.9225 60.0242 51.7392C59.9969 51.9308 59.9696 52.1224 59.9435 52.3151C60.2967 49.8326 60.8283 47.377 61.5483 44.9681C61.8732 43.8789 61.1508 42.5624 59.9617 42.3047C58.7555 42.0427 57.5198 42.6512 57.1712 43.8172Z" fill="#0E0142"/>
                                <path d="M83.5936 34.6209C83.5936 34.6209 82.9974 39.2688 85.9776 39.0566C89.7824 38.7859 92.6217 40.7348 91.3724 44.5241C90.0845 48.4294 83.99 45.7151 83.5505 54.0333C83.1348 61.9012 86.2615 73.2151 102.503 73.2151C122.038 73.2151 118.646 51.0841 118.646 51.0841L117.176 44.5155C117.174 44.5155 104.833 32.4588 83.5936 34.6209Z" fill="#0E0142"/>
                                <path d="M4.22733 18.8444C4.3409 18.6495 4.46469 18.4589 4.58735 18.2694C4.92467 17.753 5.28245 17.2474 5.65157 16.7504C5.948 16.352 6.25352 15.9601 6.56699 15.5736C6.44887 15.7197 6.33074 15.8659 6.21149 16.012C6.88953 15.1762 7.60279 14.3675 8.35126 13.5879C9.24055 12.6612 10.1787 11.7755 11.1645 10.9408C11.7721 10.4254 12.3979 9.93063 13.0419 9.45642C12.8886 9.56901 12.7353 9.68163 12.5819 9.79531C14.1845 8.61627 15.896 7.57148 17.7064 6.70859C18.2482 6.44983 18.799 6.20839 19.3578 5.9832C19.1772 6.05574 18.9955 6.12828 18.8149 6.2019C20.4788 5.53389 22.2108 5.01961 23.9826 4.68615C24.5085 4.58654 25.0377 4.50317 25.5693 4.43604C25.3682 4.46203 25.1672 4.48801 24.9651 4.51291C25.6192 4.42954 26.2757 4.37109 26.9344 4.33428C27.2468 4.3451 27.5386 4.28339 27.8101 4.14806C28.0918 4.06036 28.3348 3.91094 28.5415 3.69982C28.763 3.50385 28.9197 3.27108 29.0117 3.00258C29.1537 2.7449 29.2196 2.46665 29.2071 2.16783C29.181 1.60809 28.9879 1.02668 28.5415 0.636911C28.1122 0.261221 27.5375 -0.030005 26.9356 0.00247537C25.2285 0.0966685 23.5181 0.325108 21.8542 0.699715C20.4618 1.01261 19.0966 1.43701 17.7757 1.95886C16.3492 2.52293 14.9602 3.14766 13.6291 3.89579C12.5251 4.51616 11.4621 5.20257 10.4433 5.94421C9.34844 6.74106 8.28425 7.5704 7.27684 8.46686C6.48863 9.16843 5.73222 9.90358 5.0076 10.6658C4.38294 11.323 3.78212 12.0018 3.20743 12.6991C2.6316 13.3974 2.06713 14.1033 1.5356 14.8319C1.24258 15.2336 0.957503 15.6418 0.684922 16.0565C0.559989 16.247 0.436196 16.4386 0.32035 16.6346C0.315807 16.6432 0.310113 16.6508 0.30557 16.6595C0.0159534 17.1575 -0.0839951 17.7736 0.0761461 18.3279C0.146563 18.6094 0.281726 18.8552 0.482755 19.0641C0.642896 19.3001 0.855266 19.4853 1.1199 19.6217C1.64689 19.887 2.2852 20.0201 2.87011 19.8404C3.42663 19.6672 3.93658 19.3435 4.22733 18.8444Z" fill="#0E0142"/>
                                <path d="M127.7 16.66C127.622 16.5257 127.539 16.3947 127.455 16.2637C127.219 15.8967 126.974 15.5361 126.722 15.181C126.334 14.6343 125.928 14.0983 125.508 13.5732C124.855 12.758 124.187 11.9546 123.479 11.1816C122.791 10.4302 122.072 9.70483 121.323 9.00867C120.487 8.23131 119.612 7.48967 118.702 6.79243C117.576 5.92953 116.414 5.10777 115.192 4.37263C114.059 3.69162 112.882 3.07884 111.664 2.54941C110.212 1.91821 108.72 1.36605 107.183 0.955713C105.555 0.522642 103.885 0.253056 102.206 0.0906537C101.829 0.0538426 101.449 0.0256887 101.071 0.0051178C100.759 -0.00570899 100.467 0.0560005 100.195 0.191335C99.9137 0.279032 99.6706 0.428431 99.4639 0.639553C99.2425 0.835518 99.0857 1.06829 98.9937 1.33679C98.8517 1.59447 98.7859 1.87274 98.7984 2.17156C98.8245 2.73131 99.0176 3.31269 99.4639 3.70246C99.6173 3.81506 99.7706 3.92767 99.9239 4.04135C100.278 4.23731 100.66 4.33584 101.07 4.33692C101.729 4.37265 102.385 4.43218 103.039 4.51555C102.838 4.48957 102.637 4.46359 102.435 4.43868C104.264 4.67362 106.063 5.09371 107.799 5.6881C108.267 5.84834 108.731 6.02157 109.189 6.20562C109.009 6.13308 108.827 6.06054 108.646 5.98692C110.559 6.75779 112.377 7.7311 114.082 8.86141C114.537 9.16348 114.984 9.47639 115.422 9.79903C115.269 9.68643 115.116 9.57382 114.962 9.46014C116.079 10.283 117.142 11.1697 118.15 12.1105C119.033 12.9334 119.873 13.7963 120.671 14.6949C121.055 15.128 121.428 15.5686 121.792 16.0168C121.674 15.8707 121.555 15.7245 121.436 15.5784C121.947 16.2096 122.439 16.8559 122.905 17.5196C123.167 17.8931 123.421 18.271 123.661 18.6586C123.7 18.7214 123.74 18.7842 123.776 18.8481C123.919 19.1003 124.113 19.3028 124.361 19.4554C124.58 19.6471 124.838 19.7759 125.133 19.843C125.435 19.9329 125.737 19.9459 126.039 19.882C126.342 19.869 126.623 19.7835 126.884 19.6254C127.369 19.3277 127.796 18.8838 127.928 18.3316C128.067 17.7524 128.005 17.1829 127.7 16.66Z" fill="#0E0142"/>
                                <path d="M37.791 135.227C38.3362 135.303 38.8836 135.368 39.431 135.429C40.3987 135.535 41.3686 135.62 42.3397 135.693C43.8298 135.804 45.3222 135.884 46.8145 135.934C48.7044 135.998 50.5955 136.016 52.4865 135.985C54.6853 135.951 56.8819 135.851 59.0739 135.68C61.635 135.481 64.1904 135.184 66.7266 134.79C69.2082 134.405 71.6717 133.91 74.0976 133.283C76.5588 132.646 78.9825 131.874 81.3346 130.935C83.8685 129.922 86.3308 128.777 88.6534 127.375C90.9624 125.981 93.1521 124.369 95.1136 122.554C95.5713 122.13 96.0154 121.694 96.4481 121.247C96.8535 120.828 97.1137 120.294 97.1137 119.716C97.1137 119.184 96.866 118.551 96.4481 118.185C96.0154 117.806 95.4464 117.525 94.8421 117.55C94.2538 117.575 93.6462 117.759 93.2362 118.185C91.8914 119.576 90.4218 120.852 88.8522 122.008C89.0055 121.895 89.1588 121.783 89.3122 121.669C87.0304 123.345 84.5522 124.767 81.9593 125.959C81.2188 126.3 80.4692 126.621 79.7117 126.926C79.8922 126.854 80.074 126.781 80.2545 126.708C78.1125 127.569 75.9125 128.292 73.6774 128.899C71.4638 129.5 69.2173 129.987 66.9537 130.379C65.7158 130.594 64.4732 130.779 63.2262 130.94C63.4272 130.914 63.6282 130.888 63.8304 130.863C61.4374 131.17 59.033 131.382 56.6229 131.512C54.4639 131.629 52.3002 131.678 50.1366 131.669C48.3296 131.66 46.5227 131.609 44.718 131.515C43.4039 131.446 42.0898 131.355 40.7792 131.234C40.0716 131.17 39.3652 131.098 38.6599 131.01C38.6201 131.005 38.5804 131.001 38.5406 130.995C38.7416 131.021 38.9427 131.047 39.1448 131.072C39.096 131.066 39.0483 131.06 39.0006 131.053C38.3714 130.966 37.8228 130.952 37.2504 131.271C36.779 131.534 36.3293 132.049 36.2066 132.565C36.0737 133.119 36.1033 133.742 36.4361 134.233C36.7302 134.672 37.2208 135.149 37.791 135.227Z" fill="#0E0142"/>
                                <path d="M92.4929 110.613C92.6383 110.608 92.7848 110.609 92.9302 110.611C93.3265 110.617 93.7229 110.638 94.1182 110.67C94.4282 110.695 94.7383 110.728 95.0472 110.767C94.8462 110.741 94.6452 110.715 94.443 110.69C95.6446 110.844 96.8337 111.101 97.9831 111.472C98.3613 111.594 98.735 111.729 99.103 111.877C98.9224 111.804 98.7407 111.732 98.5601 111.658C99.4301 112.008 100.267 112.43 101.05 112.934C101.285 113.085 101.515 113.243 101.74 113.409C101.587 113.296 101.434 113.184 101.28 113.07C102.112 113.684 102.862 114.394 103.505 115.188C103.387 115.042 103.269 114.895 103.15 114.749C103.811 115.568 104.351 116.467 104.774 117.418C104.698 117.246 104.622 117.073 104.544 116.9C105.084 118.123 105.423 119.416 105.609 120.729C105.581 120.537 105.554 120.346 105.528 120.153C105.609 120.733 105.66 121.316 105.686 121.9C105.711 122.47 105.922 123.022 106.351 123.431C106.557 123.642 106.801 123.792 107.083 123.879C107.353 124.015 107.645 124.078 107.958 124.066C108.546 124.041 109.156 123.857 109.564 123.431C109.962 123.018 110.256 122.477 110.23 121.9C110.192 121.057 110.09 120.222 109.963 119.387C109.873 118.795 109.752 118.208 109.593 117.629C109.265 116.431 108.777 115.253 108.161 114.162C107.605 113.18 106.899 112.264 106.116 111.437C105.381 110.662 104.532 109.996 103.641 109.39C102.946 108.916 102.202 108.508 101.429 108.161C100.545 107.766 99.6334 107.416 98.6998 107.143C98.0274 106.947 97.3437 106.789 96.6532 106.666C95.8888 106.53 95.1153 106.429 94.3408 106.357C93.9296 106.319 93.5162 106.293 93.1028 106.283C92.9075 106.277 92.7121 106.275 92.5168 106.28C92.5088 106.28 92.4997 106.28 92.4918 106.282C91.8943 106.305 91.3151 106.507 90.8858 106.916C90.6643 107.112 90.5076 107.345 90.4156 107.613C90.2736 107.871 90.2078 108.149 90.2202 108.448C90.2464 109.008 90.4395 109.589 90.8858 109.979C91.3208 110.359 91.8875 110.638 92.4929 110.613Z" fill="#0E0142"/>
                                <path d="M36.9694 36.5626C38.9911 36.5648 41.0104 36.6914 43.0139 36.9448C42.8129 36.9188 42.6118 36.8928 42.4097 36.8679C46.3439 37.3735 50.1975 38.3696 53.8569 39.8388C53.6763 39.7663 53.4946 39.6937 53.314 39.6201C56.8087 41.0308 60.107 42.8638 63.1133 45.0724C62.96 44.9599 62.8066 44.8473 62.6533 44.7336C63.228 45.158 63.7914 45.5943 64.3445 46.0436C64.7363 46.3619 65.1304 46.5731 65.6483 46.6391C66.1321 46.7008 66.6739 46.6423 67.0964 46.3825C67.9403 45.8639 68.4241 44.8884 68.1401 43.9367C67.2395 40.915 66.0424 37.9636 64.5625 35.1562C63.1621 32.5004 61.4631 30.0156 59.5118 27.6987C57.6833 25.5268 55.5889 23.6202 53.2697 21.9323C51.055 20.3213 48.6177 19.0557 46.0179 18.1062C43.4807 17.1794 40.7696 16.6705 38.0563 16.5558C35.3271 16.4399 32.5366 16.7723 29.9152 17.502C27.2951 18.2307 24.7692 19.3556 22.4863 20.7815C20.083 22.2821 17.8797 24.0912 15.9512 26.1202C13.9079 28.2693 12.1135 30.6512 10.6052 33.1695C8.99581 35.8556 7.68745 38.7182 6.65278 41.6479C6.3995 42.3658 6.16441 43.089 5.94521 43.8166C5.6783 44.7033 6.11329 45.8206 6.98896 46.2623C7.34558 46.4421 7.73172 46.5406 8.13491 46.5579C8.74935 46.5839 9.2934 46.2851 9.74088 45.9234C10.2508 45.512 10.7699 45.1125 11.298 44.7227C11.1447 44.8353 10.9913 44.948 10.838 45.0616C13.8534 42.8486 17.1607 41.0135 20.6668 39.6028C20.4862 39.6753 20.3045 39.7478 20.1239 39.8215C23.7651 38.3653 27.5983 37.3746 31.511 36.8712C31.31 36.8971 31.1089 36.9231 30.9068 36.948C32.9193 36.6915 34.9432 36.5648 36.9694 36.5626C38.1574 36.5615 39.2954 35.5676 39.2409 34.3972C39.1864 33.2247 38.2426 32.2308 36.9694 32.2319C32.5865 32.2362 28.1696 32.8068 23.9537 33.9555C19.9024 35.0588 15.9739 36.6936 12.3838 38.7972C10.3258 40.0023 8.37343 41.374 6.53011 42.8605C7.79534 43.5632 9.06169 44.2648 10.3269 44.9674C10.8846 43.115 11.5524 41.2928 12.3372 39.5162C12.2611 39.6883 12.185 39.8615 12.1078 40.0337C13.2447 37.471 14.6212 35.0036 16.2624 32.7018C16.7087 32.0749 17.1755 31.4621 17.6605 30.8612C17.5424 31.0074 17.4243 31.1535 17.305 31.2997C19.07 29.1257 21.0882 27.1411 23.3676 25.4543C23.2143 25.5669 23.061 25.6795 22.9077 25.7932C24.7896 24.4074 26.8385 23.2359 29.0305 22.3524C28.8499 22.425 28.6682 22.4975 28.4876 22.5711C30.4309 21.7949 32.4696 21.2535 34.5582 20.9828C34.3572 21.0088 34.1561 21.0348 33.954 21.0597C35.9904 20.802 38.0541 20.802 40.0893 21.0597C39.8883 21.0337 39.6873 21.0077 39.4851 20.9828C41.5715 21.2524 43.6079 21.7927 45.55 22.5679C45.3694 22.4954 45.1877 22.4228 45.0071 22.3492C47.1969 23.2305 49.2446 24.3998 51.1254 25.7824C50.9721 25.6698 50.8188 25.5572 50.6655 25.4435C52.9426 27.1271 54.9609 29.1084 56.7247 31.277C56.6066 31.1308 56.4885 30.9846 56.3692 30.8385C58.1262 33.0092 59.6288 35.3597 60.8884 37.8228C61.2666 38.5623 61.6221 39.3126 61.9582 40.0716C61.8821 39.8994 61.8061 39.7262 61.7288 39.554C62.5227 41.3578 63.1973 43.2059 63.7584 45.0865C65.0236 44.3839 66.29 43.6823 67.5552 42.9796C64.3672 40.3855 60.8486 38.1726 57.045 36.4868C53.1221 34.7491 48.9857 33.4889 44.7107 32.8425C42.1473 32.4549 39.5635 32.233 36.9671 32.2308C35.7791 32.2297 34.6411 33.228 34.6956 34.3962C34.7536 35.5709 35.6962 36.5615 36.9694 36.5626Z" fill="#0E0142"/>
                                <path d="M8.13152 44.3935C6.76521 48.9473 6.01562 53.9016 6.01562 59.0855C6.01562 81.3887 19.8979 99.4694 37.0217 99.4694C54.1454 99.4694 68.0277 81.3887 68.0277 59.0855C68.0277 53.9482 67.2906 49.035 65.947 44.5148C58.2262 38.2201 48.0794 34.4004 36.9649 34.4004C25.922 34.4004 15.8342 38.1714 8.13152 44.3935Z" fill="white"/>
                                <path d="M5.96022 43.8172C4.74383 47.8913 4.04986 52.1192 3.83293 56.3481C3.63531 60.1884 3.87952 64.0232 4.47806 67.8234C4.99823 71.1267 5.84437 74.3856 7.03578 77.5264C8.19879 80.5915 9.65027 83.5721 11.4584 86.3394C13.1427 88.9162 15.128 91.3512 17.4063 93.4754C19.5393 95.4643 21.9618 97.2301 24.5968 98.5737C27.1375 99.8686 29.8985 100.833 32.7469 101.273C35.8385 101.75 38.913 101.724 41.9931 101.161C44.8257 100.644 47.5765 99.6153 50.0808 98.2587C52.6908 96.8458 55.0883 95.0279 57.1861 92.986C59.4292 90.8033 61.3838 88.3251 63.0273 85.7039C64.7911 82.8911 66.2073 79.8704 67.3215 76.7729C68.4936 73.5151 69.2796 70.1512 69.7611 66.7408C70.2961 62.9492 70.4551 59.1241 70.1825 55.3055C70.0246 53.0914 69.7327 50.8806 69.3136 48.6979C69.1262 47.7181 68.9093 46.7437 68.6629 45.7769C68.5391 45.2907 68.4073 44.8068 68.2688 44.3239C68.1177 43.7999 67.9246 43.2921 67.4896 42.9153C67.3181 42.767 67.1353 42.6295 66.9558 42.4898C63.9711 40.1458 60.7228 38.1277 57.219 36.56C53.6334 34.9544 49.8616 33.7461 45.966 33.0489C41.8977 32.3213 37.7363 32.0604 33.6056 32.3505C29.5759 32.6342 25.5724 33.3693 21.7483 34.6188C18.0515 35.827 14.4897 37.4564 11.2244 39.507C9.59462 40.5313 8.03182 41.6594 6.54058 42.8601C6.11808 43.2001 5.87504 43.8822 5.87504 44.391C5.87504 44.9226 6.12262 45.556 6.54058 45.9219C6.9733 46.3009 7.54233 46.5824 8.14655 46.5564C8.77689 46.5293 9.27093 46.3106 9.75249 45.9219C10.2454 45.5246 10.7463 45.1381 11.2562 44.7613C11.1029 44.8739 10.9496 44.9865 10.7962 45.1002C13.8083 42.8829 17.111 41.0445 20.6137 39.6283C20.4331 39.7009 20.2514 39.7734 20.0708 39.847C23.7143 38.3832 27.5497 37.3872 31.4669 36.8772C31.2659 36.9032 31.0649 36.9292 30.8627 36.9541C34.9106 36.4377 39.0209 36.4366 43.0698 36.9509C42.8688 36.9249 42.6678 36.8989 42.4656 36.874C46.368 37.3796 50.1887 38.3681 53.8197 39.82C53.6391 39.7474 53.4574 39.6749 53.2768 39.6012C56.8011 41.0196 60.1243 42.8655 63.1533 45.0948C63 44.9822 62.8467 44.8696 62.6933 44.7559C63.2578 45.1727 63.8109 45.6025 64.3538 46.0443C64.1596 45.726 63.9643 45.4077 63.7701 45.0883C64.4719 47.4604 64.9921 49.878 65.3396 52.3206C65.3124 52.1289 65.2851 51.9373 65.259 51.7446C65.8019 55.6314 65.9132 59.5713 65.5884 63.4798C65.5055 64.4737 65.3942 65.4643 65.2545 66.4528C65.2817 66.2612 65.309 66.0695 65.3351 65.8768C64.8433 69.3284 64.0063 72.7356 62.791 76.0204C62.4616 76.9115 62.1028 77.7928 61.7177 78.6643C61.7938 78.4922 61.8699 78.319 61.9472 78.1468C60.5025 81.397 58.6705 84.4924 56.4104 87.2911C56.5285 87.145 56.6466 86.9988 56.7658 86.8526C54.9861 89.0461 52.9486 91.0491 50.6441 92.7467C50.7975 92.6341 50.9508 92.5215 51.1041 92.4079C49.2449 93.771 47.2232 94.9251 45.063 95.7988C45.2436 95.7263 45.4254 95.6537 45.6059 95.5801C43.6615 96.3596 41.6229 96.9042 39.5331 97.1782C39.7341 97.1522 39.9351 97.1262 40.1373 97.1013C38.0793 97.3644 35.9929 97.3644 33.9338 97.1013C34.1348 97.1273 34.3359 97.1533 34.538 97.1782C32.4482 96.9042 30.4084 96.3607 28.4652 95.5801C28.6457 95.6527 28.8275 95.7252 29.0081 95.7988C26.8478 94.9251 24.8262 93.7699 22.967 92.4079C23.1203 92.5205 23.2736 92.633 23.4269 92.7467C21.1236 91.0491 19.085 89.0472 17.3052 86.8526C17.4234 86.9988 17.5415 87.145 17.6607 87.2911C15.4006 84.4913 13.5686 81.397 12.1239 78.1468C12.2 78.319 12.2761 78.4922 12.3534 78.6643C10.9621 75.5159 9.93308 72.2267 9.25163 68.8726C9.04947 67.8787 8.8791 66.8804 8.736 65.8768C8.76325 66.0684 8.79051 66.2601 8.81663 66.4528C8.29759 62.7608 8.17038 59.0191 8.43614 55.3023C8.52132 54.1113 8.64854 52.9225 8.81322 51.7392C8.78596 51.9308 8.75871 52.1224 8.73259 52.3151C9.0858 49.8326 9.61732 47.377 10.3374 44.9681C10.6622 43.8789 9.93988 42.5624 8.75075 42.3047C7.54458 42.0427 6.3089 42.6512 5.96022 43.8172Z" fill="#0E0142"/>
                                <path d="M32.3671 34.6209C32.3671 34.6209 31.7708 39.2688 34.751 39.0566C38.5558 38.7859 41.3952 40.7348 40.1459 44.5241C38.8579 48.4294 32.7634 45.7151 32.3239 54.0333C31.9082 61.9012 35.035 73.2151 51.2762 73.2151C70.8112 73.2151 67.4198 51.0841 67.4198 51.0841L65.949 44.5155C65.9479 44.5155 53.6068 32.4588 32.3671 34.6209Z" fill="#0E0142"/>
                                <path d="M65.8079 42.5937C67.7466 41.4547 69.7728 40.4576 71.8706 39.612C71.69 39.6845 71.5083 39.7571 71.3277 39.8307C74.9735 38.3691 78.8123 37.3763 82.7318 36.8707C82.5307 36.8967 82.3297 36.9226 82.1276 36.9475C85.2906 36.5459 88.4946 36.4571 91.6758 36.6877C92.5435 36.7505 93.4079 36.8382 94.2699 36.9475C94.0689 36.9215 93.8678 36.8956 93.6657 36.8707C96.7265 37.2658 99.742 37.9544 102.653 38.9386C103.467 39.2136 104.272 39.5124 105.07 39.8318C104.889 39.7592 104.707 39.6867 104.527 39.6131C107.258 40.7142 109.874 42.0718 112.322 43.6699C113.019 44.1257 113.701 44.5999 114.37 45.0925C114.217 44.9799 114.064 44.8673 113.91 44.7536C114.475 45.1705 115.029 45.6003 115.572 46.0431C115.964 46.3614 116.358 46.5726 116.876 46.6386C117.36 46.7003 117.902 46.6418 118.324 46.382C119.168 45.8634 119.652 44.8879 119.368 43.9362C118.461 40.895 117.254 37.9241 115.761 35.1016C114.36 32.4544 112.662 29.9783 110.713 27.6689C108.879 25.4949 106.778 23.5862 104.45 21.8994C102.238 20.297 99.8022 19.0367 97.2081 18.0937C94.6527 17.1648 91.9212 16.6581 89.1897 16.552C86.2992 16.4405 83.344 16.827 80.5886 17.6628C77.781 18.5138 75.1063 19.7979 72.7133 21.4349C70.1692 23.1748 67.8829 25.2145 65.9079 27.5304C64.8278 28.796 63.8135 30.1136 62.8947 31.4897C62.4643 32.1339 62.0531 32.7911 61.6613 33.457C61.4625 33.7948 61.2683 34.1358 61.0798 34.479C60.9844 34.6512 60.8913 34.8255 60.7981 34.9987C60.7584 35.0734 60.7175 35.1481 60.6789 35.2239C60.5062 35.5714 60.3495 35.9179 60.3688 36.3163C60.3881 36.718 60.5142 37.0461 60.6789 37.4088C61.2774 38.7307 61.8873 40.0483 62.4915 41.3681C62.5597 41.5175 62.629 41.668 62.6971 41.8174C62.9095 42.2808 63.5671 42.6846 64.0543 42.8124C64.6006 42.9542 65.3252 42.8893 65.8079 42.5937C66.2929 42.296 66.7199 41.8521 66.8517 41.2999C66.8789 41.1083 66.9062 40.9166 66.9323 40.7239C66.9312 40.3331 66.8278 39.9682 66.6223 39.6315C66.0351 38.3485 65.4479 37.0655 64.8607 35.7826C64.7755 35.5963 64.6892 35.409 64.604 35.2228C64.604 35.9514 64.604 36.6801 64.604 37.4088C65.817 35.1048 67.2401 32.9037 68.8904 30.8618C68.7722 31.008 68.6541 31.1541 68.5349 31.3003C70.31 29.1143 72.3408 27.1189 74.6361 25.4267C74.4828 25.5393 74.3295 25.6519 74.1762 25.7656C76.049 24.3917 78.0865 23.2289 80.2649 22.3519C80.0843 22.4245 79.9026 22.497 79.722 22.5706C81.6721 21.7922 83.7188 21.2508 85.8142 20.9813C85.6132 21.0072 85.4122 21.0332 85.21 21.0581C87.2475 20.8026 89.3135 20.8048 91.351 21.0657C91.15 21.0397 90.949 21.0137 90.7468 20.9888C92.8275 21.2606 94.8594 21.8019 96.7958 22.576C96.6152 22.5035 96.4335 22.431 96.2529 22.3573C98.4256 23.2332 100.459 24.3939 102.327 25.7645C102.174 25.6519 102.02 25.5393 101.867 25.4256C104.154 27.1125 106.181 29.0992 107.95 31.2764C107.832 31.1303 107.714 30.9841 107.595 30.838C109.341 32.9946 110.837 35.3311 112.092 37.7779C112.468 38.5109 112.821 39.2536 113.155 40.005C113.079 39.8329 113.003 39.6596 112.926 39.4875C113.733 41.3118 114.418 43.1838 114.986 45.0893C116.251 44.3866 117.518 43.685 118.783 42.9824C115.99 40.7098 112.942 38.722 109.667 37.1359C106.313 35.5119 102.752 34.2462 99.0866 33.4321C95.2887 32.5887 91.359 32.1794 87.4599 32.239C83.411 32.3007 79.337 32.8496 75.4357 33.8868C71.69 34.8829 68.0476 36.3391 64.6778 38.1904C64.286 38.4059 63.8964 38.6278 63.5114 38.8541C63.0174 39.1443 62.6233 39.6109 62.4677 40.1479C62.3178 40.6665 62.3859 41.3562 62.6971 41.8163C63.3536 42.7832 64.7255 43.2292 65.8079 42.5937Z" fill="#0E0142"/>
                              </svg>
                        </div>
                        <h1>${kommoflash_home_page_data.lang['The Kommo server is not responding']}</h1>
                        <h3>${kommoflash_home_page_data.lang['We are aware of the issue and are working to fix it']}</h3>
                        <button id="hover-element-click" data-js-action="page-reload">${kommoflash_home_page_data.lang['Try again']}</button>
                    </div>
                    `);
                jQuery(".content-home-page").remove();
            }
        },
        welcome_frame: {
            show: function () {
                waitForElementToActive(".welcome-frame");
            }
        },
        exit_frame: {
            show: function () {
                waitForElementToActive(".exit-frame");
            }
        },
        off_button_frame: {
            show: function () {
                waitForElementToActive(".off-button-frame");
            }
        },
        select_plan_frame: {
            show: function () {
                window.KOMMO_FLASH.preloader.hide.allow = false;
                waitForElementToActive(".select-plan-frame");
            }
        },
        add_button_frame: {
            show: function () {
                waitForElementToActive(".add-button-frame");
            }
        }
    },
    client: {
        get_data: function () {
            return {};
        },
        print_data: function () {
            window.KOMMO_FLASH.client.check_buttons();
            window.KOMMO_FLASH.trial.check();
            window.KOMMO_FLASH.inbox.tryInbox();
        },
        check_buttons: function () {
            const data = {
                'action': 'kommo_dashboard_action',
                'get_buttons_data': true,
                'nonce': kommo_admin_data.nonce,
                'target_id': targetId,
                'target_instance_id': targetInstanceId,
            };
            jQuery.ajax({
                url: ajaxPostUrlTemplate + '',
                method: 'post',
                dataType: 'json',
                data: data,
                success: function (response) {
                    window.KOMMO_FLASH.request.ajax.count.complete += 1;
                    try {
                        if (response.data.notifications.hasOwnProperty('show_modal_chat_button_select')) {
                            window.KOMMO_FLASH.dropdowns.chat_buttons.parse_select(response.data.data['modal_chat_button_select']);
                            window.KOMMO_FLASH.modals.add_button_frame.show();
                        }
                        if (response.data.notifications.hasOwnProperty('show_modal_welcome')) {
                            window.KOMMO_FLASH.modals.welcome_frame.show();
                        }
                        if (response.data.chat_button_need_button === parseInt(kommoflash_home_page_data.constants.chat_button_need_button)) {
                            window.KOMMO_FLASH.preloader.hide.allow = false;
                            window.KOMMO_FLASH.modals.error_delete_button_user.show();
                        }
                        if (response.data.sources_count === 0 && response.data.account_sign_init === 0) {

                        }
                        window.KOMMO_FLASH.link.button_settings.update(response);
                    } catch (e) {
                    }
                },
            });
        }
    },
    trial: {
        check: function () {
            const data = {
                'action': 'kommo_dashboard_action',
                'trial_get_value': true,
                'nonce': kommo_admin_data.nonce,
                'target_id': targetId,
                'target_instance_id': targetInstanceId,
            };
            jQuery.ajax({
                url: ajaxPostUrlTemplate + '',
                method: 'post',
                dataType: 'json',
                data: data,
                success: function (response) {
                    window.KOMMO_FLASH.request.ajax.count.complete += 1;
                    try {
                        let day_trial = response.data;

                        if (day_trial) {
                            if (day_trial === parseInt(kommoflash_home_page_data.constants.trial_show_modal_frame)) {
                                window.KOMMO_FLASH.modals.select_plan_frame.show();
                                jQuery(".trial-frame").css("display", "none");
                            } else {
                                let color = '';
                                if (day_trial <= parseInt(kommoflash_home_page_data.constants.trial_count_days_edit_bg)) {
                                    jQuery(".trial-frame").css("background", "#FF3D60");
                                    color = '#FF3D60';
                                } else {
                                    jQuery(".trial-frame").css("background", "#5F43D0");
                                    color = '#5F43D0';
                                }
                                const template = `
                                        <h3>
                                            <span style="color: ${color}">${day_trial}</span>
                                            ${kommoflash_home_page_data.lang['Days left in your trial. ']}
                                            <a target="_blank" href="${kommoflash_home_page_data.account.links.subscribe}">
                                                ${kommoflash_home_page_data.lang['Subscribe']}
                                            </a>
                                        </h3>
                                    `;
                                jQuery(".trial-frame").html(jQuery(template));
                            }
                        }
                    } catch (e) {
                    }
                },
            });
        }
    },
    dropdowns: {
        chat_buttons: {
            value: 0,
            parse_select: function (buttons) {
                try {
                    jQuery('.buttons-frame-dropdown-select .dropdown-select-text').append(jQuery('.add-button-frame select').val());
                    buttons.forEach(function (element) {
                        jQuery('.button-frame-dropdown-item').append('<div class="item-dropdown" id="' + element.source_id + '">' + element.name + '</div>');
                    });
                } catch (e) {
                }
            }
        }
    },
    inbox: {
        button: {
            update_db: function (state) {
                const data = {
                    'action': 'kommo_dashboard_action',
                    'button_update_db': true,
                    'state': state,
                    'nonce': kommo_admin_data.nonce,
                    'target_id': targetId,
                    'target_instance_id': targetInstanceId,
                };
                jQuery.get(ajaxGetUrlTemplate + '', data, function (data) {
                });
            },
            check_db: function () {
                const data = {
                    'action': 'kommo_dashboard_action',
                    'button_get_db': true,
                    'nonce': kommo_admin_data.nonce,
                    'target_id': targetId,
                    'target_instance_id': targetInstanceId,
                };
                jQuery.get(ajaxGetUrlTemplate + '', data, function (response) {
                    window.KOMMO_FLASH.request.ajax.count.complete += 1;

                    try {
                        let response_json = JSON.parse(response);
                        jQuery('.footer-block input[type="checkbox"]').prop('checked', response_json.data);
                        if (response_json.data) {
                            jQuery('#checkbox-text-off').css('display', 'block');
                            jQuery('#checkbox-text-on').css('display', 'none');
                        } else {
                            jQuery('#checkbox-text-off').css('display', 'none');
                            jQuery('#checkbox-text-on').css('display', 'block');
                        }
                    } catch (e) {

                    }
                });
            }
        },
        tryInbox: function () {
            const template = `<p>${kommoflash_home_page_data.lang['Try your']}
                                    <a target="_blank" href="${kommoflash_home_page_data.site.url}">${kommoflash_home_page_data.lang['website chat button']}</a>
                                ${kommoflash_home_page_data.lang['to see how leads flow directly to your inbox.']}</p>`;

            jQuery('.item-block-1 .text-block .element-to-line p').replaceWith(jQuery(template));
        },
        get: function () {
            const data = {
                'action': 'kommo_dashboard_action',
                'inbox_get_count': true,
                'nonce': kommo_admin_data.nonce,
                'target_id': targetId,
                'target_instance_id': targetInstanceId,
            };
            jQuery.ajax({
                url: ajaxPostUrlTemplate + '',
                method: 'post',
                dataType: 'json',
                data: data,
                success: function (response) {
                    window.KOMMO_FLASH.request.ajax.count.complete += 1;
                    try {
                        let action = response.data.action;
                        let count = response.data.count;

                        if (action === 'not-have-any-buttons-yet') {
                            jQuery('.checkbox-slider').css('display', 'none');
                            jQuery('.checkbox-text').css('display', 'none');
                            jQuery('.item-block-1 .text-block .go-to-inbox').css('display', 'none');
                            jQuery('.item-block-1 .text-block').css('position', 'relative');
                            if (window.outerWidth > 768) {
                                jQuery('.item-block-1 .text-block .element-to-line').css('position', 'absolute');
                                jQuery('.item-block-1 .text-block .element-to-line').css('bottom', '0');
                            }
                            jQuery('.exit-frame h3').html(kommoflash_home_page_data.lang['You are about to log out']);
                            jQuery('.exit-frame h5')
                                .html(kommoflash_home_page_data.lang['When you log back in, a chat button will be automatically created.']);
                            jQuery('.item-block-1 .text-block .element-to-line')
                                .html(`<h5>${kommoflash_home_page_data.lang['You do not have any chat buttons yet.']}<br><div>${kommoflash_home_page_data.lang['Log out of your Kommo account, then log back in to automatically generate a new chat button.']}</div></h5>`);
                        }
                        if (action === 'have-unread-messages') {
                            const count_inbox = count > parseInt(kommoflash_home_page_data.constants.inbox_limit_message)
                                ? parseInt(kommoflash_home_page_data.constants.inbox_limit_message)
                                : count;

                            jQuery('.item-block-1 .text-block .element-to-line p').text(response.data.text);
                            jQuery('.item-block-1 .text-block span').text(count_inbox);
                            jQuery('.item-block-1 .text-block span').css('display', 'flex');
                            jQuery('.toplevel_page_website-chat-button-kommo-integration > .wp-menu-name')
                                .append(' <span class="menu-counter site-health-counter count-3"><span class="count">' + count_inbox + '</span></span>');
                        }
                        if (action === 'try-inbox') {
                            window.KOMMO_FLASH.inbox.tryInbox();
                        }
                        if (action === 'no-unread-messages') {
                            jQuery('.item-block-1 .text-block .element-to-line p')
                                .text(kommoflash_home_page_data.lang['You have no unread messages']);
                        }
                    } catch (e) {
                    }
                },
            });
        }
    },
    link: {
        button_settings: {
            update: function (response) {
                try {
                    if (response.data.button_settings_link.length === 0) {
                        return;
                    }
                    jQuery('[data-js-id="button-settings-link"]').attr('href', response.data.button_settings_link);
                } catch (e) {

                }
            }
        },
    }
}
jQuery(document).ready(function () {
    jQuery(".overlay-block #close-button").click(function () {
        if (jQuery('.off-button-frame.active').length) {
            jQuery('.footer-block input[type="checkbox"]').prop('checked', true);
        }
        jQuery(".overlay-block.active, .overlay-block .active").removeClass("active");
        jQuery(".content-home-page").css('position', 'unset');
    });
    jQuery(".overlay-block").click(function (e) {
        jQuery("body").css('overflow-y', 'unset');
        if (jQuery(e.target).hasClass("display-padding")) {
            if (jQuery('.error-log-frame.active').length) {
                jQuery(".error-log-frame").removeClass("active");
                jQuery(".content-home-page").css('position', 'unset');
            } else {
                if (jQuery('.off-button-frame.active').length) {
                    jQuery('.footer-block input[type="checkbox"]').prop('checked', true);
                }
                jQuery(".overlay-block.active, .overlay-block .active").removeClass("active");
                jQuery(".content-home-page").css('position', 'unset');
            }
        }
    });

    jQuery(".buttons-frame-dropdown-select").click(function (e) {
        if (jQuery('.button-frame-dropdown-item.active').length) {
            jQuery('.add-button-frame.active .text-frame .buttons-frame-dropdown-select').css('color', '#0E0142');
            jQuery('.add-button-frame.active .text-frame .buttons-frame-dropdown-select').css('border', '2px solid #0E0142');
            jQuery(".buttons-frame-dropdown-select svg path").attr('stroke', '#0E0142');
            jQuery(".button-frame-dropdown-item").removeClass("active");
            jQuery(".buttons-frame-dropdown-select svg").css('rotate', '180deg');
        } else {
            jQuery('.add-button-frame.active .text-frame .buttons-frame-dropdown-select').css('color', '#5F44D1');
            jQuery('.add-button-frame.active .text-frame .buttons-frame-dropdown-select').css('border', '2px solid #5F44D1');
            jQuery(".buttons-frame-dropdown-select svg path").attr('stroke', '#5F44D1');
            jQuery(".button-frame-dropdown-item").addClass("active");
            jQuery(".buttons-frame-dropdown-select svg").css('rotate', '0deg');
        }
    });
    jQuery(document).on('click', '.item-dropdown', function () {
        var itemId = jQuery(this).attr('id');
        var itemText = jQuery(this).text();
        jQuery(".button-frame-dropdown-item").removeClass("active");
        jQuery(".buttons-frame-dropdown-select svg").css('transform', 'rotate(180deg)');
        jQuery('.buttons-frame-dropdown-select .dropdown-select-text').text(itemText);
        jQuery('.add-button-frame .add-button-frame-next').css('display', 'flex');
        jQuery('.add-button-frame .add-button-frame-next-disable').css('display', 'none');

        window.KOMMO_FLASH.dropdowns.chat_buttons.value = itemId;
    });

    window.KOMMO_FLASH.modals.preloader.show();

    if (parseInt(kommoflash_home_page_data.chat_button_data_exist)) {
        window.KOMMO_FLASH.inbox.get();
        let interval = setInterval(function () {
            if (window.KOMMO_FLASH.request.ajax.count.complete >= window.KOMMO_FLASH.request.ajax.list.length &&
                window.KOMMO_FLASH.preloader.hide.allow
            ) {
                clearInterval(interval);
                window.KOMMO_FLASH.modals.preloader.hide();
            }
        }, 100);
    }

    window.KOMMO_FLASH.client.print_data();
    window.KOMMO_FLASH.inbox.button.check_db();

    jQuery(document).on('click', '[data-js-action]', function (e) {
        const action = jQuery(e.target).attr('data-js-action');

        switch (action) {
            case 'page-reload':
                window.location.reload();
                break;
        }
    })
});
